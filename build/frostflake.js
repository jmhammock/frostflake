function _classPrivateFieldSet(e,t,i){var r=t.get(e);if(!r)throw new TypeError("attempted to set private field on non-instance");if(r.set)r.set.call(e,i);else{if(!r.writable)throw new TypeError("attempted to set read only private field");r.value=i}return i}function _classPrivateFieldGet(e,t){var i=t.get(e);if(!i)throw new TypeError("attempted to get private field on non-instance");return i.get?i.get.call(e):i.value}function _defineProperty(e,t,i){return t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}class GameTime{constructor(){_defineProperty(this,"startTime",void 0),_defineProperty(this,"lastFrameTime",void 0),_defineProperty(this,"frameSeconds",void 0),_defineProperty(this,"gameTimeSeconds",void 0),_defineProperty(this,"recentFrames",[]),this.startTime=new Date,this.lastFrameTime=new Date,this.frameSeconds=0,this.gameTimeSeconds=0}update(){let e=this.lastFrameTime.getTime(),t=new Date,i=t-e;i<GameTime.MAX_FRAME_DELTA?this.frameSeconds=i/1e3:this.frameSeconds=0,this.gameTimeSeconds+=this.frameSeconds,this.lastFrameTime=t,this.recentFrames.push(this.frameSeconds),this.recentFrames.length>GameTime.FPS_SAMPLES&&this.recentFrames.shift()}aveFps(){let e=0;for(let t=0;t<this.recentFrames.length;t++)e+=this.recentFrames[t];return 1/(e/this.recentFrames.length)}}_defineProperty(GameTime,"MAX_FRAME_DELTA",500),_defineProperty(GameTime,"FPS_SAMPLES",60);class MathUtil{static invert(e){return 0-e}static normalizeAngle(e){const t=2*Math.PI;for(;e<0;)e+=t;for(;e>t;)e-=t;return e}static angleTo(e,t){let i=t.x-e.x,r=t.y-e.y;return MathUtil.normalizeAngle(Math.atan2(r,i))}static randomInRange(e,t){const i=t-e;return Math.random()*i+e}static vectorSubtract(e,t){return"number"==typeof t?{x:e.x-t,y:e.y-t}:{x:e.x-t.x,y:e.y-t.y}}static vectorMultiply(e,t){return"number"==typeof t?{x:e.x*t,y:e.y*t}:{x:e.x*t.x,y:e.y*t.y}}static vectorNormalize(e){let t=MathUtil.vectorLength(e);return 0==t?e:{x:e.x/t,y:e.y/t}}static vectorDot(e,t){return e.x*t.x+e.y*t.y}static vectorLength(e){return MathUtil.length(e.x,e.y)}static length(e,t){let i=Math.pow(e,2)+Math.pow(t,2);return Math.abs(Math.sqrt(i))}static clamp(e,t,i){return e=Math.min(i,e),e=Math.max(t,e)}}class RepositionType{}_defineProperty(RepositionType,"None",0),_defineProperty(RepositionType,"Move",1),_defineProperty(RepositionType,"Bounce",2);class Positionable{get x(){return this.position.x}set x(e){this.position.x=e}get y(){return this.position.y}set y(e){this.position.y=e}get rotation(){return this.position.rotation}set rotation(e){this.position.rotation=e}get absolutePosition(){let e={x:0,y:0,rotation:0};if(null!=this.parent){let t=this.parent.absolutePosition,i=MathUtil.length(this.x,this.y);e.x=Math.cos(t.rotation)*i+t.x,e.y=Math.sin(t.rotation)*i+t.y,e.rotation=t.rotation+this.rotation}else e.x=this.x,e.y=this.y,e.rotation=this.rotation;return e}get root(){for(var e=this;e.parent instanceof Positionable;)e=e.parent;return e}constructor(e=0,t=0){_defineProperty(this,"position",{x:0,y:0,rotation:0}),_defineProperty(this,"velocity",{x:0,y:0,rotation:0}),_defineProperty(this,"acceleration",{x:0,y:0,rotation:0}),_defineProperty(this,"drag",0),_defineProperty(this,"layer",0),_defineProperty(this,"parent",null),_defineProperty(this,"children",[])}addChild(e){e.parent=this,this.children.push(e),this.children.sort((e,t)=>e.layer-t.layer)}removeChild(e){let t=this.children.indexOf(e);t>-1&&this.children.splice(t,1),e.parent=null}attach(e){e.addChild(this)}detach(){this.parent instanceof Positionable&&this.parent.removeChild(this)}moveRootX(e){for(var t=this;t.parent instanceof Positionable;)t=t.parent;t.position.x+=e}moveRootY(e){for(var t=this;t.parent instanceof Positionable;)t=t.parent;t.position.y+=e}update(){this.preUpdate();let e=FrostFlake.Game.time.frameSeconds,t=e*e/2;this.position.x+=this.velocity.x*e+this.acceleration.x*t,this.position.y+=this.velocity.y*e+this.acceleration.y*t,this.position.rotation+=this.velocity.rotation*e+this.acceleration.rotation*t,this.velocity.x+=this.acceleration.x*e-this.drag*this.velocity.x*e,this.velocity.y+=this.acceleration.y*e-this.drag*this.velocity.y*e,this.velocity.rotation+=this.acceleration.rotation*e-this.drag*this.velocity.rotation*e,this.position.rotation=MathUtil.normalizeAngle(this.position.rotation);for(let e=0;e<this.children.length;e++)this.children[e].update()}preUpdate(){}}class Sprite extends Positionable{get collision(){return _classPrivateFieldGet(this,_collisionShape)}set collision(e){_classPrivateFieldGet(this,_collisionShape)&&(_classPrivateFieldGet(this,_collisionShape).parent=null),_classPrivateFieldSet(this,_collisionShape,e),_classPrivateFieldGet(this,_collisionShape).parent=this}constructor(e=null){super(),_defineProperty(this,"alpha",1),_defineProperty(this,"frame",null),_defineProperty(this,"texture",null),_defineProperty(this,"animation",null),_defineProperty(this,"scale",1),_collisionShape.set(this,{writable:!0,value:null});this.texture=e,this.collision=new Circle}getAbsolutePosition(){let e={x:0,y:0,rotation:0};if(null!=this.parent){let t=this.parent.getAbsolutePosition(),i=MathUtil.length(this.x,this.y);e.x=Math.cos(t.rotation)*i+t.x,e.y=Math.sin(t.rotation)*i+t.y,e.rotation=t.rotation+this.rotation}else e.x=this.x,e.y=this.y,e.rotation=this.rotation;return e}update(){super.update(),this.animation&&(this.animation.update(),this.texture=this.animation.texture,this.frame=this.animation.currentFrame)}}var _collisionShape=new WeakMap;class Shape extends Positionable{constructor(){super()}get absolutePosition(){let e={x:0,y:0,rotation:0};if(null!=this.parent){let t=this.parent.absolutePosition,i=MathUtil.length(this.x,this.y);e.x=Math.cos(t.rotation)*i+t.x,e.y=Math.sin(t.rotation)*i+t.y,e.rotation=t.rotation+this.rotation}else e.x=this.x,e.y=this.y,e.rotation=this.rotation;return e}static collideCircleVsCircle(e,t,i=RepositionType.None,r=1,s=0,o=1){let n=MathUtil.vectorSubtract(t.absolutePosition,e.absolutePosition),a=MathUtil.length(n.x,n.y),h=e.radius+t.radius-a,l=h>0;if(l&&i!=RepositionType.None){let a=MathUtil.vectorNormalize(n);0==MathUtil.vectorLength(a)&&(a.y=1);let l=s/(r+s),y=r/(r+s);if(e.root.position.x+=a.x*(-h*l),e.root.position.y+=a.y*(-h*l),t.root.position.x+=a.x*(h*y),t.root.position.y+=a.y*(h*y),i==RepositionType.Bounce){let i=MathUtil.vectorDot(MathUtil.vectorSubtract(e.root.velocity,t.root.velocity),a)*o,r=MathUtil.vectorMultiply(a,i*l);e.root.velocity.x-=2*r.x,e.root.velocity.y-=2*r.y;let s=MathUtil.vectorMultiply(a,i*y);t.root.velocity.x+=2*s.x,t.root.velocity.y+=2*s.y}}return l}static collideCircleVsRect(e,t,i=RepositionType.None,r=1,s=0,o=1){let n=e.radius+t.width/2,a=e.absolutePosition.x-t.absolutePosition.x,h=n-Math.abs(a),l=e.radius+t.height/2,y=e.absolutePosition.y-t.absolutePosition.y,d=l-Math.abs(y),c=h>0&&d>0;if(c&&i!=RepositionType.None){let n={x:(h<=d?1:0)*Math.sign(a),y:(h>=d?1:0)*Math.sign(y)};0==MathUtil.vectorLength(n)&&(n.y=1);let l=s/(r+s),c=r/(r+s);if(e.root.position.x+=n.x*h*l,e.root.position.y+=n.y*d*l,t.root.position.x-=n.x*h*c,t.root.position.y-=n.y*d*c,i==RepositionType.Bounce){let i=MathUtil.vectorDot(MathUtil.vectorSubtract(e.root.velocity,t.root.velocity),n)*o,r=MathUtil.vectorMultiply(n,i*l);e.root.velocity.x-=2*r.x,e.root.velocity.y-=2*r.y;let s=MathUtil.vectorMultiply(n,i*c);t.root.velocity.x+=2*s.x,t.root.velocity.y+=2*s.y}}return c}static collideRectVsRect(e,t,i=RepositionType.None,r=1,s=0,o=1){let n=e.width/2+t.width/2,a=e.absolutePosition.x-t.absolutePosition.x,h=n-Math.abs(a),l=e.height/2+t.height/2,y=e.absolutePosition.y-t.absolutePosition.y,d=l-Math.abs(y),c=h>0&&d>0;if(c&&i!=RepositionType.None){let n={x:(h<=d?1:0)*Math.sign(a),y:(h<=d?0:1)*Math.sign(y)};0==MathUtil.vectorLength(n)&&(n.y=1);let l=s/(r+s),c=r/(r+s);if(e.root.position.x+=n.x*h*l,e.root.position.y+=n.y*d*l,t.root.position.x-=n.x*h*c,t.root.position.y-=n.y*d*c,i==RepositionType.Bounce){let i=MathUtil.vectorDot(MathUtil.vectorSubtract(e.root.velocity,t.root.velocity),n)*o,r=MathUtil.vectorMultiply(n,i*l);e.root.velocity.x-=2*r.x,e.root.velocity.y-=2*r.y;let s=MathUtil.vectorMultiply(n,i*c);t.root.velocity.x+=2*s.x,t.root.velocity.y+=2*s.y}}return c}}class Circle extends Shape{constructor(e=16){super(),_defineProperty(this,"radius",void 0),this.radius=e}collideWith(e,t=RepositionType.None,i=1,r=0,s=1){return e instanceof Circle?Shape.collideCircleVsCircle(this,e,t,i,r,s):e instanceof Rectangle?Shape.collideCircleVsRect(this,e,t,i,r,s):void 0}}class Rectangle extends Shape{get left(){return this.absolutePosition.x-this.width/2}get right(){return this.absolutePosition.x+this.width/2}get top(){return this.absolutePosition.y+this.height/2}get bottom(){return this.absolutePosition.y-this.height/2}constructor(e,t){super(),_defineProperty(this,"width",void 0),_defineProperty(this,"height",void 0),this.width=e,this.height=t}collideWith(e,t=RepositionType.None,i=1,r=0,s=1){return e instanceof Circle?Shape.collideCircleVsRect(e,this,t,r,i,s):e instanceof Rectangle?Shape.collideRectVsRect(this,e,t,i,r,s):void 0}}class CanvasRenderer{constructor(e,t){_textureCache.set(this,{writable:!0,value:{}}),_defineProperty(this,"context",void 0),_defineProperty(this,"background","rgb(0,0,0)"),this.context=e.getContext("2d"),this.background=t}checkAndPreloadPositionables(e){let t=!0;for(let i=0;i<e.length;i++)if(this.textureLoaded(e[i].texture)||(t=!1),e[i].children.length>0){!1===this.checkAndPreloadPositionables(e[i].children)&&(t=!1)}return t}draw(e,t){this.context,this.background;let i=1/t.resolution,r=MathUtil.invert(t.x)+this.context.canvas.width/2*t.resolution,s=t.y+this.context.canvas.height/2*t.resolution;this.context.save(),this.context.imageSmoothingEnabled=t.antialias,this.context.fillStyle=this.background,this.context.fillRect(0,0,this.context.canvas.width,this.context.canvas.height),this.context.scale(i,i),this.context.translate(r,s);for(let t=0;t<e.length;t++)e[t]instanceof Sprite&&this.drawSprite(e[t],this.context);this.context.restore()}drawSprite(e,t){let i=e.x,r=MathUtil.invert(e.y),s=-e.rotation,o=e.alpha;if(this.context.save(),this.context.translate(i,r),this.context.rotate(s),this.context.globalAlpha=o,this.textureLoaded(e.texture)){let t=_classPrivateFieldGet(this,_textureCache)[e.texture];null==e.frame&&(e.frame=new Frame,e.frame.width=t.width,e.frame.height=t.height),this.context.drawImage(t,e.frame.left,e.frame.top,e.frame.width,e.frame.height,e.frame.width/-2*e.scale,e.frame.height/-2*e.scale,e.frame.width*e.scale,e.frame.height*e.scale),FrostFlake.Game.showDebug&&(this.context.strokeStyle="rgba(255, 255, 255, 0.3)",this.context.strokeRect(-e.frame.width/2*e.scale,-e.frame.height/2*e.scale,e.frame.width*e.scale,e.frame.height*e.scale))}else this.loadTexture(e.texture);if(this.context.globalAlpha=1,FrostFlake.Game.showDebug&&(this.context.strokeStyle="Red",e.collision instanceof Circle?(this.context.beginPath(),this.context.arc(0,0,e.collision.radius,0,2*Math.PI),this.context.stroke()):e.collision instanceof Rectangle&&(this.context.save(),this.strokeStyle="Red",this.context.rotate(e.collision.absolutePosition.rotation),this.context.strokeRect(-e.collision.width/2,-e.collision.height/2,e.collision.width,e.collision.height),this.context.restore())),e.children.length>0)for(let t=0;t<e.children.length;t++)this.drawSprite(e.children[t],this.context);this.context.restore()}textureLoaded(e){return null!==e&&e in _classPrivateFieldGet(this,_textureCache)&&_classPrivateFieldGet(this,_textureCache)[e]instanceof HTMLImageElement==!0&&!0===_classPrivateFieldGet(this,_textureCache)[e].complete}loadTexture(e,t=null){let i=new XMLHttpRequest,r=this;""==e||null==e||e in _classPrivateFieldGet(this,_textureCache)||(_classPrivateFieldGet(r,_textureCache)[e]="...",i.addEventListener("readystatechange",()=>{if(i.readyState===XMLHttpRequest.DONE){if(200!==i.status)throw`Failed to load ${e}`;{let t=document.createElement("img");t.src=URL.createObjectURL(i.response),_classPrivateFieldGet(r,_textureCache)[e]=t}}}),i.responseType="blob",i.open("GET",e,!0),i.send())}}var _textureCache=new WeakMap;class Camera extends Rectangle{constructor(e,t){super(e,t),_defineProperty(this,"resolution",1),_defineProperty(this,"antialias",!1)}}class Frame{constructor(e=0,t=0,i=0,r=0,s=0){_defineProperty(this,"top",0),_defineProperty(this,"left",0),_defineProperty(this,"width",0),_defineProperty(this,"height",0),_defineProperty(this,"seconds",0),this.left=e,this.top=t,this.width=i,this.height=r,this.seconds=s}}class Animation{constructor(){_defineProperty(this,"name",""),_defineProperty(this,"frames",[]),_defineProperty(this,"texture",""),_defineProperty(this,"playing",!0),_defineProperty(this,"looping",!0),_defineProperty(this,"frameIndex",-1),_secondsLeftInFrame.set(this,{writable:!0,value:0})}get currentFrame(){return this.frames[this.frameIndex]}start(){this.frameIndex<0&&this.restart(),this.playing=!0}stop(){this.playing=!1}restart(){this.frameIndex=0,_classPrivateFieldSet(this,_secondsLeftInFrame,this.currentFrame.seconds),this.playing=!0}update(){let e=FrostFlake.Game.time.frameSeconds;if(this.playing&&this.frames&&this.frames.length>1)for(_classPrivateFieldSet(this,_secondsLeftInFrame,_classPrivateFieldGet(this,_secondsLeftInFrame)-e);_classPrivateFieldGet(this,_secondsLeftInFrame)<=0&&(this.frameIndex<this.frames.length-1?this.frameIndex+=1:this.looping&&(this.frameIndex=0),_classPrivateFieldSet(this,_secondsLeftInFrame,_classPrivateFieldGet(this,_secondsLeftInFrame)+this.currentFrame.seconds),!(_classPrivateFieldGet(this,_secondsLeftInFrame)<0&&this.currentFrame.seconds<=0)););}}var _secondsLeftInFrame=new WeakMap;class View{constructor(){_defineProperty(this,"children",[])}update(){for(let e=0;e<this.children.length;e++)this.children[e].update()}renderToTexture(e,t){let i=new Camera,r=document.createElement("canvas");return r.width=e,r.height=t,FrostFlake.Game.renderer.draw(this.children,i,r,"rgba(0,0,0,0)"),r.toDataURL()}addChild(e){if(this.children.indexOf(e)>-1)throw"positionable has already been added to view.";this.children.push(e)}removeChild(e){let t=this.children.indexOf(e);t>-1&&this.children.splice(t,1)}clearChildren(){this.children=[]}}class Log{constructor(e="debug"){_level.set(this,{writable:!0,value:void 0}),_levels.set(this,{writable:!0,value:{debug:0,info:1,warn:2,error:3}}),_reverseLevels.set(this,{writable:!0,value:{0:"debug",1:"info",2:"warn",3:"error"}}),this.setLevel(e)}setLevel(e){if(!(e in _classPrivateFieldGet(this,_levels)))throw`${e} is not a valid debug level`;_classPrivateFieldSet(this,_level,e)}debug(e){this.write(_classPrivateFieldGet(this,_levels).debug,e)}info(e){this.write(_classPrivateFieldGet(this,_levels).info,e)}warn(e){this.write(_classPrivateFieldGet(this,_levels).warn,e)}error(e){this.write(_classPrivateFieldGet(this,_levels).error,e)}write(e,t){if(_classPrivateFieldGet(this,_levels)[_classPrivateFieldGet(this,_level)]<e){let i=_classPrivateFieldGet(this,_reverseLevels)[e];console.log(`${i}: ${t}`)}}}var _level=new WeakMap,_levels=new WeakMap,_reverseLevels=new WeakMap;class Cursor{constructor(){_defineProperty(this,"x",0),_defineProperty(this,"y",0),_defineProperty(this,"changeX",0),_defineProperty(this,"changeY",0),_defineProperty(this,"worldX",0),_defineProperty(this,"worldY",0),_defineProperty(this,"isInFrame",!1)}update(){this.worldX=FrostFlake.Game.camera.x+this.x,this.worldY=FrostFlake.Game.camera.y+this.y}setHardwarePosition(e,t){let i=e-FrostFlake.Game.canvas.width/2,r=MathUtil.invert(t)+FrostFlake.Game.canvas.height/2;this.changeX=this.x-i,this.changeY=this.y-r,this.x=i,this.y=r}}class Keys{}_defineProperty(Keys,"Backspace",8),_defineProperty(Keys,"Tab",9),_defineProperty(Keys,"Enter",13),_defineProperty(Keys,"Shift",16),_defineProperty(Keys,"Ctrl",17),_defineProperty(Keys,"Alt",18),_defineProperty(Keys,"PauseBreak",19),_defineProperty(Keys,"CapsLock",20),_defineProperty(Keys,"Esc",27),_defineProperty(Keys,"Space",32),_defineProperty(Keys,"PageUp",33),_defineProperty(Keys,"PageDown",34),_defineProperty(Keys,"End",35),_defineProperty(Keys,"Home",36),_defineProperty(Keys,"Left",37),_defineProperty(Keys,"Up",38),_defineProperty(Keys,"Right",39),_defineProperty(Keys,"Down",40),_defineProperty(Keys,"Insert",45),_defineProperty(Keys,"Delete",46),_defineProperty(Keys,"Oem0",48),_defineProperty(Keys,"Oem1",49),_defineProperty(Keys,"Oem2",50),_defineProperty(Keys,"Oem3",51),_defineProperty(Keys,"Oem4",52),_defineProperty(Keys,"Oem5",53),_defineProperty(Keys,"Oem6",54),_defineProperty(Keys,"Oem7",55),_defineProperty(Keys,"Oem8",56),_defineProperty(Keys,"Oem9",57),_defineProperty(Keys,"A",65),_defineProperty(Keys,"B",66),_defineProperty(Keys,"C",67),_defineProperty(Keys,"D",68),_defineProperty(Keys,"E",69),_defineProperty(Keys,"F",70),_defineProperty(Keys,"G",71),_defineProperty(Keys,"H",72),_defineProperty(Keys,"I",73),_defineProperty(Keys,"J",74),_defineProperty(Keys,"K",75),_defineProperty(Keys,"L",76),_defineProperty(Keys,"M",77),_defineProperty(Keys,"N",78),_defineProperty(Keys,"O",79),_defineProperty(Keys,"P",80),_defineProperty(Keys,"Q",81),_defineProperty(Keys,"R",82),_defineProperty(Keys,"S",83),_defineProperty(Keys,"T",84),_defineProperty(Keys,"U",85),_defineProperty(Keys,"V",86),_defineProperty(Keys,"W",87),_defineProperty(Keys,"X",88),_defineProperty(Keys,"Y",89),_defineProperty(Keys,"Z",90),_defineProperty(Keys,"Windows",91),_defineProperty(Keys,"RightClick",93),_defineProperty(Keys,"Num0",96),_defineProperty(Keys,"Num1",97),_defineProperty(Keys,"Num2",98),_defineProperty(Keys,"Num3",99),_defineProperty(Keys,"Num4",100),_defineProperty(Keys,"Num5",101),_defineProperty(Keys,"Num6",102),_defineProperty(Keys,"Num7",103),_defineProperty(Keys,"Num8",104),_defineProperty(Keys,"Num9",105),_defineProperty(Keys,"NumStar",106),_defineProperty(Keys,"NumPlus",107),_defineProperty(Keys,"NumMinus",109),_defineProperty(Keys,"NumPeriod",110),_defineProperty(Keys,"NumSlash",111),_defineProperty(Keys,"F1",112),_defineProperty(Keys,"F2",113),_defineProperty(Keys,"F3",114),_defineProperty(Keys,"F4",115),_defineProperty(Keys,"F5",116),_defineProperty(Keys,"F6",117),_defineProperty(Keys,"F7",118),_defineProperty(Keys,"F8",119),_defineProperty(Keys,"F9",120),_defineProperty(Keys,"F10",121),_defineProperty(Keys,"F11",122),_defineProperty(Keys,"F12",123),_defineProperty(Keys,"NumLock",144),_defineProperty(Keys,"ScrollLock",145),_defineProperty(Keys,"MyComputer",182),_defineProperty(Keys,"MyCalculator",183),_defineProperty(Keys,"Semicolon",186),_defineProperty(Keys,"Equal",187),_defineProperty(Keys,"Comma",188),_defineProperty(Keys,"Dash",189),_defineProperty(Keys,"Period",190),_defineProperty(Keys,"ForwardSlash",191),_defineProperty(Keys,"Tick",192),_defineProperty(Keys,"LeftBracket",219),_defineProperty(Keys,"Backslash",220),_defineProperty(Keys,"RightBracket",221),_defineProperty(Keys,"SingleQuote",222),_defineProperty(Keys,"char8","Backspace"),_defineProperty(Keys,"char9","Tab"),_defineProperty(Keys,"char13","Enter"),_defineProperty(Keys,"char16","Shift"),_defineProperty(Keys,"char17","Ctrl"),_defineProperty(Keys,"char18","Alt"),_defineProperty(Keys,"char19","PauseBreak"),_defineProperty(Keys,"char20","CapsLock"),_defineProperty(Keys,"char27","Esc"),_defineProperty(Keys,"char32","Space"),_defineProperty(Keys,"char33","PageUp"),_defineProperty(Keys,"char34","PageDown"),_defineProperty(Keys,"char35","End"),_defineProperty(Keys,"char36","Home"),_defineProperty(Keys,"char37","Left"),_defineProperty(Keys,"char38","Up"),_defineProperty(Keys,"char39","Right"),_defineProperty(Keys,"char40","Down"),_defineProperty(Keys,"char45","Insert"),_defineProperty(Keys,"char46","Delete"),_defineProperty(Keys,"char48","Oem0"),_defineProperty(Keys,"char49","Oem1"),_defineProperty(Keys,"char50","Oem2"),_defineProperty(Keys,"char51","Oem3"),_defineProperty(Keys,"char52","Oem4"),_defineProperty(Keys,"char53","Oem5"),_defineProperty(Keys,"char54","Oem6"),_defineProperty(Keys,"char55","Oem7"),_defineProperty(Keys,"char56","Oem8"),_defineProperty(Keys,"char57","Oem9"),_defineProperty(Keys,"char65","A"),_defineProperty(Keys,"char66","B"),_defineProperty(Keys,"char67","C"),_defineProperty(Keys,"char68","D"),_defineProperty(Keys,"char69","E"),_defineProperty(Keys,"char70","F"),_defineProperty(Keys,"char71","G"),_defineProperty(Keys,"char72","H"),_defineProperty(Keys,"char73","I"),_defineProperty(Keys,"char74","J"),_defineProperty(Keys,"char75","K"),_defineProperty(Keys,"char76","L"),_defineProperty(Keys,"char77","M"),_defineProperty(Keys,"char78","N"),_defineProperty(Keys,"char79","O"),_defineProperty(Keys,"char80","P"),_defineProperty(Keys,"char81","Q"),_defineProperty(Keys,"char82","R"),_defineProperty(Keys,"char83","S"),_defineProperty(Keys,"char84","T"),_defineProperty(Keys,"char85","U"),_defineProperty(Keys,"char86","V"),_defineProperty(Keys,"char87","W"),_defineProperty(Keys,"char88","X"),_defineProperty(Keys,"char89","Y"),_defineProperty(Keys,"char90","Z"),_defineProperty(Keys,"char91","Windows"),_defineProperty(Keys,"char93","RightClick"),_defineProperty(Keys,"char96","Num0"),_defineProperty(Keys,"char97","Num1"),_defineProperty(Keys,"char98","Num2"),_defineProperty(Keys,"char99","Num3"),_defineProperty(Keys,"char100","Num4"),_defineProperty(Keys,"char101","Num5"),_defineProperty(Keys,"char102","Num6"),_defineProperty(Keys,"char103","Num7"),_defineProperty(Keys,"char104","Num8"),_defineProperty(Keys,"char105","Num9"),_defineProperty(Keys,"char106","NumStar"),_defineProperty(Keys,"char107","NumPlus"),_defineProperty(Keys,"char109","NumMinus"),_defineProperty(Keys,"char110","NumPeriod"),_defineProperty(Keys,"char111","NumSlash"),_defineProperty(Keys,"char112","F1"),_defineProperty(Keys,"char113","F2"),_defineProperty(Keys,"char114","F3"),_defineProperty(Keys,"char115","F4"),_defineProperty(Keys,"char116","F5"),_defineProperty(Keys,"char117","F6"),_defineProperty(Keys,"char118","F7"),_defineProperty(Keys,"char119","F8"),_defineProperty(Keys,"char120","F9"),_defineProperty(Keys,"char121","F10"),_defineProperty(Keys,"char122","F11"),_defineProperty(Keys,"char123","F12"),_defineProperty(Keys,"char144","NumLock"),_defineProperty(Keys,"char145","ScrollLock"),_defineProperty(Keys,"char182","MyComputer"),_defineProperty(Keys,"char183","MyCalculator"),_defineProperty(Keys,"char186","Semicolon"),_defineProperty(Keys,"char187","Equal"),_defineProperty(Keys,"char188","Comma"),_defineProperty(Keys,"char189","Dash"),_defineProperty(Keys,"char190","Period"),_defineProperty(Keys,"char191","ForwardSlash"),_defineProperty(Keys,"char192","Tick"),_defineProperty(Keys,"char219","LeftBracket"),_defineProperty(Keys,"char220","Backslash"),_defineProperty(Keys,"char221","RightBracket"),_defineProperty(Keys,"char222","SingleQuote");class Mouse{}_defineProperty(Mouse,"Left",1),_defineProperty(Mouse,"Middle",2),_defineProperty(Mouse,"Right",3),_defineProperty(Mouse,"button1","Left"),_defineProperty(Mouse,"button2","Middle"),_defineProperty(Mouse,"button3","Right");class Input{constructor(){_defineProperty(this,"cursor",void 0),_keysDown.set(this,{writable:!0,value:{}}),_keysPushed.set(this,{writable:!0,value:{}}),_buttonsDown.set(this,{writable:!0,value:{}}),_buttonsPushed.set(this,{writable:!0,value:{}}),this.cursor=new Cursor,window.addEventListener("keydown",e=>this.onKeyDown(e)),window.addEventListener("keyup",e=>this.onKeyUp(e)),window.addEventListener("mousemove",e=>this.onMouseMove(e)),window.addEventListener("mousedown",e=>this.onMouseDown(e)),window.addEventListener("mouseup",e=>this.onMouseUp(e)),FrostFlake.Game.canvas.addEventListener("mouseenter",e=>this.onEnterCanvas(e)),FrostFlake.Game.canvas.addEventListener("mouseleave",e=>this.onExitCanvas(e))}update(){this.cursor.update();for(let e in _classPrivateFieldGet(this,_keysPushed))_classPrivateFieldGet(this,_keysPushed)[e]=!1;for(let e in _classPrivateFieldGet(this,_buttonsPushed))_classPrivateFieldGet(this,_buttonsPushed)[e]=!1}keyDown(e){let t=Keys["char"+e];return!0===_classPrivateFieldGet(this,_keysDown)[t]}keyPushed(e){let t=Keys["char"+e];return!0===_classPrivateFieldGet(this,_keysPushed)[t]}buttonDown(e){let t=Mouse["button"+e];return!0===_classPrivateFieldGet(this,_buttonsDown)[t]}buttonPushed(e){let t=Mouse["button"+e];return!0===_classPrivateFieldGet(this,_buttonsPushed)[t]}stopPropagation(e){FrostFlake.Game.audio.enable(),this.cursor.isInFrame&&e.preventDefault()}onEnterCanvas(e){this.cursor.isInFrame=!0}onExitCanvas(e){this.cursor.isInFrame=!1}onMouseMove(e){this.cursor.setHardwarePosition(e.offsetX,e.offsetY)}onMouseDown(e){let t=Mouse["button"+e.which];_classPrivateFieldGet(this,_buttonsDown)[t]=!0,this.stopPropagation(e)}onMouseUp(e){let t=Mouse["button"+e.which];_classPrivateFieldGet(this,_buttonsDown)[t]=!1,_classPrivateFieldGet(this,_buttonsPushed)[t]=!0,this.stopPropagation(e)}onKeyDown(e){let t=Keys["char"+e.keyCode];_classPrivateFieldGet(this,_keysDown)[t]=!0,this.stopPropagation(e)}onKeyUp(e){let t=Keys["char"+e.keyCode];_classPrivateFieldGet(this,_keysDown)[t]=!1,_classPrivateFieldGet(this,_keysPushed)[t]=!0,this.stopPropagation(e)}}var _keysDown=new WeakMap,_keysPushed=new WeakMap,_buttonsDown=new WeakMap,_buttonsPushed=new WeakMap;class Audio{constructor(){_defineProperty(this,"context",void 0),_audioCache.set(this,{writable:!0,value:{}}),this.context=new AudioContext}enable(){"suspended"===this.context.state&&this.context.resume()}playSound(e){if(this.audioLoaded(e)){let t=this.context.createBufferSource();return t.buffer=_classPrivateFieldGet(this,_audioCache)[e],t.connect(this.context.destination),t.start(0),t}return FrostFlake.Log.warn(`Audio not loaded ${e}, attempting to load now.`),this.loadSound(e),null}audioLoaded(e){return null!==e&&""!==e&&e in _classPrivateFieldGet(this,_audioCache)&&_classPrivateFieldGet(this,_audioCache)[e]instanceof AudioBuffer}loadSound(e,t=null){let i=new XMLHttpRequest,r=this;""==e||null==e||e in _classPrivateFieldGet(this,_audioCache)||"running"!=this.context.state||(_classPrivateFieldGet(r,_audioCache)[e]="...",i.addEventListener("readystatechange",()=>{i.readyState==XMLHttpRequest.DONE&&(200===i.status?i.response instanceof ArrayBuffer?r.context.decodeAudioData(i.response,function(t){_classPrivateFieldGet(r,_audioCache)[e]=t},function(){FrostFlake.Log.error(`Failed to decode audio for: ${e}`)}):FrostFlake.Log.error(`Response was not an ArrayBuffer: ${e}`):FrostFlake.Log.error(`Failed to load ${e} with response ${i.status}`))}),i.responseType="arraybuffer",i.open("GET",e,!0),i.send())}}var _audioCache=new WeakMap;class FrostFlake{constructor(e,t=30,i="rgb(0,0,0)"){_timer.set(this,{writable:!0,value:void 0}),_defineProperty(this,"time",void 0),_defineProperty(this,"fps",void 0),_defineProperty(this,"camera",void 0),_defineProperty(this,"canvas",void 0),_defineProperty(this,"renderer",void 0),_defineProperty(this,"view",void 0),_defineProperty(this,"background",void 0),_defineProperty(this,"input",void 0),_defineProperty(this,"audio",void 0),_defineProperty(this,"showDebug",!1),FrostFlake.Game=this,FrostFlake.Log=new Log,this.canvas=e,this.fps=t,this.background=i,this.input=new Input,this.view=new View,this.audio=new Audio,FrostFlake.Log.info("FrostFlake instance created...")}start(){FrostFlake.Log.info("Starting FrostFlake..."),this.time=new GameTime,this.camera=new Camera(this.canvas.width,this.canvas.height),this.renderer=new CanvasRenderer(this.canvas);let e=this;_classPrivateFieldSet(this,_timer,window.setInterval(function(){e.update()},1e3/this.fps))}update(){this.time.update(),this.camera.update(),this.view.update(),this.input.update(),this.renderer.draw(this.view.children,this.camera,this.canvas,this.background)}}var _timer=new WeakMap;_defineProperty(FrostFlake,"Game",void 0),_defineProperty(FrostFlake,"Log",void 0);
//# sourceMappingURL=frostflake.js.map